atal: [172.27.8.8]: FAILED! => {"msg": "An unhandled exception occurred while running the lookup plugin 'template'. Error was a <class 'ansible.errors.AnsibleError'>, original message: Unexpected templating type error occurred on (<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <style>\n    body {\n      font-family: 'Segoe UI', sans-serif;\n      background-color: #f9fbfc;\n      padding: 32px;\n      color: #333;\n      max-width: 1400px;\n      margin: auto;\n    }\n\n    h2 {\n      text-align: center;\n      color: #2e7d32;\n      font-size: 28px;\n      margin-bottom: 32px;\n      border-bottom: 2px solid #c8e6c9;\n      padding-bottom: 10px;\n    }\n\n    .summary {\n      text-align: center;\n      margin-bottom: 30px;\n      background-color: #e3f2fd;\n      border: 1px solid #bbdefb;\n      padding: 10px 18px;\n      border-radius: 8px;\n      font-size: 14px;\n      color: #0d47a1;\n    }\n\n    table {\n      width: 100%;\n      border-collapse: collapse;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.08);\n      background-color: #ffffff;\n      border-radius: 10px;\n      overflow: hidden;\n      font-size: 13px;\n    }\n\n    th {\n      background-color: #1565c0;\n      color: white;\n      padding: 12px;\n      text-align: center;\n    }\n\n    td {\n      padding: 12px;\n      text-align: center;\n      border-bottom: 1px solid #f0f0f0;\n      vertical-align: middle;\n    }\n\n    tr:hover td {\n      background-color: #f5faff;\n    }\n\n    .bar-container {\n      width: 100%;\n      background-color: #eee;\n      border-radius: 6px;\n      height: 10px;\n      overflow: hidden;\n      margin-top: 4px;\n    }\n\n    .bar {\n      height: 100%;\n      border-radius: 6px;\n    }\n\n    .cpu-bar { background-color: #ef5350; }\n    .mem-bar { background-color: #42a5f5; }\n    .disk-bar { background-color: #66bb6a; }\n    .swap-bar { background-color: #ab47bc; }\n\n    .label {\n      margin-top: 4px;\n      font-size: 11px;\n      color: #555;\n    }\n\n    .badge {\n      font-size: 11px;\n      padding: 3px 8px;\n      border-radius: 12px;\n      display: inline-block;\n      font-weight: 600;\n      color: #fff;\n      margin-top: 4px;\n    }\n\n    .healthy { background-color: #43a047; }\n    .warning { background-color: #fbc02d; color: #000; }\n    .critical { background-color: #d32f2f; }\n\n    .footer {\n      text-align: center;\n      font-size: 12px;\n      margin-top: 24px;\n      color: #666;\n    }\n  </style>\n</head>\n<body>\n  <h2>üìä Consolidated VM Health Report</h2>\n\n  <div class=\"summary\">\n    üìÖ <b>{{ collected_metrics | length }} VMs</b> | \n    üî• Avg CPU: {{ ((collected_metrics | map(attribute='cpu_usage') | map('float') | sum | float) / (collected_metrics | length)) | round(2) }}% | \n    üì• Avg Mem: {{ ((collected_metrics | map(attribute='mem_usage') | map('float') | sum | float) / (collected_metrics | length)) | round(2) }}% | \n    üì¶ Avg Disk: {{ ((collected_metrics | map(attribute='disk_usage') | map('float') | sum | float) / (collected_metrics | length)) | round(2) }}% | \n    üîÑ Avg Swap: {{ ((collected_metrics | map(attribute='swap_usage') | map('float') | sum | float) / (collected_metrics | length)) | round(2) }}%\n  </div>\n\n  <table>\n    <tr>\n      <th>üåê Hostname</th>\n      <th>üî• CPU</th>\n      <th>üì• Memory</th>\n      <th>üì¶ Disk</th>\n      <th>üîÑ Swap</th>\n      <th>üåÄ Load Avg</th>\n      <th>‚öôÔ∏è Processes</th>\n      <th>üåç Network</th>\n      <th>üìÇ Open FDs</th>\n      <th>üë§ Users</th>\n      <th>‚è±Ô∏è Uptime</th>\n    </tr>\n    {% for vm in collected_metrics %}\n    <tr>\n      <td><b>{{ vm.hostname }}</b></td>\n\n      <!-- CPU -->\n      <td>\n        {{ vm.cpu_usage }}%\n        <div class=\"bar-container\"><div class=\"bar cpu-bar\" style=\"width: {{ vm.cpu_usage }}%\"></div></div>\n        {% if vm.cpu_usage|float < 50 %}\n          <div class=\"badge healthy\">Healthy</div>\n        {% elif vm.cpu_usage|float < 80 %}\n          <div class=\"badge warning\">Warning</div>\n        {% else %}\n          <div class=\"badge critical\">Critical</div>\n        {% endif %}\n      </td>\n\n      <!-- Memory -->\n      <td>\n        {{ vm.mem_usage }}%\n        <div class=\"bar-container\"><div class=\"bar mem-bar\" style=\"width: {{ vm.mem_usage }}%\"></div></div>\n        {% if vm.mem_usage|float < 50 %}\n          <div class=\"badge healthy\">Healthy</div>\n        {% elif vm.mem_usage|float < 80 %}\n          <div class=\"badge warning\">Warning</div>\n        {% else %}\n          <div class=\"badge critical\">Critical</div>\n        {% endif %}\n      </td>\n\n      <!-- Disk -->\n      <td>\n        {{ vm.disk_usage }}%\n        <div class=\"bar-container\"><div class=\"bar disk-bar\" style=\"width: {{ vm.disk_usage }}%\"></div></div>\n        {% if vm.disk_usage|float < 50 %}\n          <div class=\"badge healthy\">Ample</div>\n        {% elif vm.disk_usage|float < 80 %}\n          <div class=\"badge warning\">Monitor</div>\n        {% else %}\n          <div class=\"badge critical\">Full</div>\n        {% endif %}\n      </td>\n\n      <!-- Swap -->\n      <td>\n        {{ vm.swap_usage }}%\n        <div class=\"bar-container\"><div class=\"bar swap-bar\" style=\"width: {{ vm.swap_usage }}%\"></div></div>\n        {% if vm.swap_usage|float < 20 %}\n          <div class=\"badge healthy\">Healthy</div>\n        {% elif vm.swap_usage|float < 50 %}\n          <div class=\"badge warning\">Moderate</div>\n        {% else %}\n          <div class=\"badge critical\">High</div>\n        {% endif %}\n      </td>\n\n      <!-- Load Average -->\n      <td>{{ vm.load_avg }}</td>\n\n      <!-- Processes -->\n      <td>\n        Running: {{ vm.running_processes }}<br>\n        Zombies: {{ vm.zombie_processes }}\n        {% if vm.zombie_processes|int > 0 %}\n          <div class=\"badge critical\">Zombie Alert</div>\n        {% endif %}\n      </td>\n\n      <!-- Network -->\n      <td>\n        RX: {{ (vm.net_rx_bytes / 1024 / 1024) | round(2) }} MB<br>\n        TX: {{ (vm.net_tx_bytes / 1024 / 1024) | round(2) }} MB<br>\n        Errors: {{ vm.net_rx_errors }}/{{ vm.net_tx_errors }}\n        {% if vm.net_rx_errors|int > 0 or vm.net_tx_errors|int > 0 %}\n          <div class=\"badge warning\">Errors</div>\n        {% endif %}\n      </td>\n\n      <!-- Open File Descriptors -->\n      <td>\n        {{ vm.open_file_descriptors }}\n        {% if vm.open_file_descriptors|int < 10000 %}\n          <div class=\"badge healthy\">Normal</div>\n        {% elif vm.open_file_descriptors|int < 50000 %}\n          <div class=\"badge warning\">High</div>\n        {% else %}\n          <div class=\"badge critical\">Critical</div>\n        {% endif %}\n      </td>\n\n      <!-- Logged-in Users -->\n      <td>{{ vm.logged_in_users }}</td>\n\n      <!-- Uptime -->\n      <td>{{ vm.uptime }}</td>\n    </tr>\n    {% endfor %}\n  </table>\n\n  <div class=\"footer\">\n    ‚è±Ô∏è Report Generated on: {{ timestamp }}\n  </div>\n</body>\n</html>\n): unsupported operand type(s) for /: 'AnsibleUnsafeText' and 'int'. unsupported operand type(s) for /: 'AnsibleUnsafeText' and 'int'. Unexpected templating type error occurred on (<!DOCTYPE html>\n<html>\n<head>\n  <meta charset=\"UTF-8\">\n  <style>\n    body {\n      font-family: 'Segoe UI', sans-serif;\n      background-color: #f9fbfc;\n      padding: 32px;\n      color: #333;\n      max-width: 1400px;\n      margin: auto;\n    }\n\n    h2 {\n      text-align: center;\n      color: #2e7d32;\n      font-size: 28px;\n      margin-bottom: 32px;\n      border-bottom: 2px solid #c8e6c9;\n      padding-bottom: 10px;\n    }\n\n    .summary {\n      text-align: center;\n      margin-bottom: 30px;\n      background-color: #e3f2fd;\n      border: 1px solid #bbdefb;\n      padding: 10px 18px;\n      border-radius: 8px;\n      font-size: 14px;\n      color: #0d47a1;\n    }\n\n    table {\n      width: 100%;\n      border-collapse: collapse;\n      box-shadow: 0 4px 12px rgba(0,0,0,0.08);\n      background-color: #ffffff;\n      border-radius: 10px;\n      overflow: hidden;\n      font-size: 13px;\n    }\n\n    th {\n      background-color: #1565c0;\n      color: white;\n      padding: 12px;\n      text-align: center;\n    }\n\n    td {\n      padding: 12px;\n      text-align: center;\n      border-bottom: 1px solid #f0f0f0;\n      vertical-align: middle;\n    }\n\n    tr:hover td {\n      background-color: #f5faff;\n    }\n\n    .bar-container {\n      width: 100%;\n      background-color: #eee;\n      border-radius: 6px;\n      height: 10px;\n      overflow: hidden;\n      margin-top: 4px;\n    }\n\n    .bar {\n      height: 100%;\n      border-radius: 6px;\n    }\n\n    .cpu-bar { background-color: #ef5350; }\n    .mem-bar { background-color: #42a5f5; }\n    .disk-bar { background-color: #66bb6a; }\n    .swap-bar { background-color: #ab47bc; }\n\n    .label {\n      margin-top: 4px;\n      font-size: 11px;\n      color: #555;\n    }\n\n    .badge {\n      font-size: 11px;\n      padding: 3px 8px;\n      border-radius: 12px;\n      display: inline-block;\n      font-weight: 600;\n      color: #fff;\n      margin-top: 4px;\n    }\n\n    .healthy { background-color: #43a047; }\n    .warning { background-color: #fbc02d; color: #000; }\n    .critical { background-color: #d32f2f; }\n\n    .footer {\n      text-align: center;\n      font-size: 12px;\n      margin-top: 24px;\n      color: #666;\n    }\n  </style>\n</head>\n<body>\n  <h2>üìä Consolidated VM Health Report</h2>\n\n  <div class=\"summary\">\n    üìÖ <b>{{ collected_metrics | length }} VMs</b> | \n    üî• Avg CPU: {{ ((collected_metrics | map(attribute='cpu_usage') | map('float') | sum | float) / (collected_metrics | length)) | round(2) }}% | \n    üì• Avg Mem: {{ ((collected_metrics | map(attribute='mem_usage') | map('float') | sum | float) / (collected_metrics | length)) | round(2) }}% | \n    üì¶ Avg Disk: {{ ((collected_metrics | map(attribute='disk_usage') | map('float') | sum | float) / (collected_metrics | length)) | round(2) }}% | \n    üîÑ Avg Swap: {{ ((collected_metrics | map(attribute='swap_usage') | map('float') | sum | float) / (collected_metrics | length)) | round(2) }}%\n  </div>\n\n  <table>\n    <tr>\n      <th>üåê Hostname</th>\n      <th>üî• CPU</th>\n      <th>üì• Memory</th>\n      <th>üì¶ Disk</th>\n      <th>üîÑ Swap</th>\n      <th>üåÄ Load Avg</th>\n      <th>‚öôÔ∏è Processes</th>\n      <th>üåç Network</th>\n      <th>üìÇ Open FDs</th>\n      <th>üë§ Users</th>\n      <th>‚è±Ô∏è Uptime</th>\n    </tr>\n    {% for vm in collected_metrics %}\n    <tr>\n      <td><b>{{ vm.hostname }}</b></td>\n\n      <!-- CPU -->\n      <td>\n        {{ vm.cpu_usage }}%\n        <div class=\"bar-container\"><div class=\"bar cpu-bar\" style=\"width: {{ vm.cpu_usage }}%\"></div></div>\n        {% if vm.cpu_usage|float < 50 %}\n          <div class=\"badge healthy\">Healthy</div>\n        {% elif vm.cpu_usage|float < 80 %}\n          <div class=\"badge warning\">Warning</div>\n        {% else %}\n          <div class=\"badge critical\">Critical</div>\n        {% endif %}\n      </td>\n\n      <!-- Memory -->\n      <td>\n        {{ vm.mem_usage }}%\n        <div class=\"bar-container\"><div class=\"bar mem-bar\" style=\"width: {{ vm.mem_usage }}%\"></div></div>\n        {% if vm.mem_usage|float < 50 %}\n          <div class=\"badge healthy\">Healthy</div>\n        {% elif vm.mem_usage|float < 80 %}\n          <div class=\"badge warning\">Warning</div>\n        {% else %}\n          <div class=\"badge critical\">Critical</div>\n        {% endif %}\n      </td>\n\n      <!-- Disk -->\n      <td>\n        {{ vm.disk_usage }}%\n        <div class=\"bar-container\"><div class=\"bar disk-bar\" style=\"width: {{ vm.disk_usage }}%\"></div></div>\n        {% if vm.disk_usage|float < 50 %}\n          <div class=\"badge healthy\">Ample</div>\n        {% elif vm.disk_usage|float < 80 %}\n          <div class=\"badge warning\">Monitor</div>\n        {% else %}\n          <div class=\"badge critical\">Full</div>\n        {% endif %}\n      </td>\n\n      <!-- Swap -->\n      <td>\n        {{ vm.swap_usage }}%\n        <div class=\"bar-container\"><div class=\"bar swap-bar\" style=\"width: {{ vm.swap_usage }}%\"></div></div>\n        {% if vm.swap_usage|float < 20 %}\n          <div class=\"badge healthy\">Healthy</div>\n        {% elif vm.swap_usage|float < 50 %}\n          <div class=\"badge warning\">Moderate</div>\n        {% else %}\n          <div class=\"badge critical\">High</div>\n        {% endif %}\n      </td>\n\n      <!-- Load Average -->\n      <td>{{ vm.load_avg }}</td>\n\n      <!-- Processes -->\n      <td>\n        Running: {{ vm.running_processes }}<br>\n        Zombies: {{ vm.zombie_processes }}\n        {% if vm.zombie_processes|int > 0 %}\n          <div class=\"badge critical\">Zombie Alert</div>\n        {% endif %}\n      </td>\n\n      <!-- Network -->\n      <td>\n        RX: {{ (vm.net_rx_bytes / 1024 / 1024) | round(2) }} MB<br>\n        TX: {{ (vm.net_tx_bytes / 1024 / 1024) | round(2) }} MB<br>\n        Errors: {{ vm.net_rx_errors }}/{{ vm.net_tx_errors }}\n        {% if vm.net_rx_errors|int > 0 or vm.net_tx_errors|int > 0 %}\n          <div class=\"badge warning\">Errors</div>\n        {% endif %}\n      </td>\n\n      <!-- Open File Descriptors -->\n      <td>\n        {{ vm.open_file_descriptors }}\n        {% if vm.open_file_descriptors|int < 10000 %}\n          <div class=\"badge healthy\">Normal</div>\n        {% elif vm.open_file_descriptors|int < 50000 %}\n          <div class=\"badge warning\">High</div>\n        {% else %}\n          <div class=\"badge critical\">Critical</div>\n        {% endif %}\n      </td>\n\n      <!-- Logged-in Users -->\n      <td>{{ vm.logged_in_users }}</td>\n\n      <!-- Uptime -->\n      <td>{{ vm.uptime }}</td>\n    </tr>\n    {% endfor %}\n  </table>\n\n  <div class=\"footer\">\n    ‚è±Ô∏è Report Generated on: {{ timestamp }}\n  </div>\n</body>\n</html>\n): unsupported operand type(s) for /: 'AnsibleUnsafeText' and 'int'. unsupported operand type(s) for /: 'AnsibleUnsafeText' and 'int'"}
